<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Installing_on_OSX</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <h2 id="unofficial-binary-packages">Unofficial Binary Packages</h2>
<ul>
<li>If you just want to give CouchDB a shot and don't like the command line based installation, you can get this unofficial binary release for Mac OS X 10.5 Leopard and Intel Macs only: <a href="http://janl.github.com/couchdbx/">http://janl.github.com/couchdbx/</a>  * Nightly build of CouchDB for OS X: <a href="http://couch.lstoll.net/nightly/">http://couch.lstoll.net/nightly/</a> </li>
</ul>
<h2 id="macports">MacPorts</h2>
<p>To install CouchDB using MacPorts</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">couchdb</span>
</pre></div>


<p>should be enough. MacPorts takes care of installing all necessary dependencies. If you have already installed some of the CouchDB dependencies via MacPorts, run this command to check and upgrade any outdated ones, <em>after installing CouchDB</em>:</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">port</span> <span class="n">upgrade</span> <span class="n">couchdb</span>
</pre></div>


<p>This will upgrade dependencies recursively, if there are more recent versions available. If you want to run CouchDB as a service controlled by the OS, load the launchd configuration which comes with the project, with this command:</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">launchctl</span> <span class="n">load</span> <span class="o">-</span><span class="n">w</span> <span class="sr">/opt/</span><span class="nb">local</span><span class="sr">/Library/</span><span class="n">LaunchDaemons</span><span class="o">/</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">couchdb</span><span class="o">.</span><span class="n">plist</span>
</pre></div>


<p>and it should be up and accessible via http://127.0.0.1:5984/_utils/index.html. It should also be restarted automatically after reboot (because of the -w flag).</p>
<p>If not, be sure to check permissions on couchdb files and repair them if neccessary:</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="nb">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">couchdb:couchdb</span> <span class="sr">/opt/</span><span class="nb">local</span><span class="sr">/var/</span><span class="n">lib</span><span class="sr">/couchdb/</span> <span class="sr">/opt/</span><span class="nb">local</span><span class="sr">/var/</span><span class="nb">log</span><span class="sr">/couchdb/</span>
</pre></div>


<p>Updating the ports collection. The collection of port files has to be updated to reflect the latest versions of available packages. In order to do that run:</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">port</span> <span class="n">selfupdate</span>
</pre></div>


<p>to update the port tree, and then install just as explained.</p>
<h2 id="dependencies-erlang">Dependencies - Erlang</h2>
<p>If Erlang fails to build with the error:</p>
<div class="codehilite"><pre><span class="n">Command</span> <span class="n">output:</span> <span class="n">megaco_flex_scanner_drv</span><span class="o">.</span><span class="n">flex:31:</span> <span class="n">unknown</span> <span class="n">error</span> <span class="n">processing</span> <span class="n">section</span> <span class="mi">1</span>
</pre></div>


<p>You will need to upgrade flex: <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=465039">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=465039</a> </p>
<h2 id="typical-build-process-of-a-couchdb-developer-build">Typical build process of a CouchDB developer build</h2>
<div class="codehilite"><pre>$ svn co <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://svn.apache.org/repos/asf/couchdb/trunk&quot;</span><span class="nt">&gt;</span>http://svn.apache.org/repos/asf/couchdb/trunk<span class="nt">&lt;/a&gt;</span> couchdb
$ cd couchdb
$ ./bootstrap <span class="err">&amp;&amp;</span> ./configure
$ make
$ sudo make install
</pre></div>


<h2 id="installing-from-source-on-mac-os-x-106-snow-leopard">Installing from source on Mac OS X 10.6 Snow Leopard</h2>
<p>Here is a recipe to install CouchDB from source on Mac OS X 10.6 Snow Leopard with needed dependencies.</p>
<ol>
<li>
<p>Install ICU</p>
<p>$ curl -O <a href="http://download.icu-project.org/files/icu4c/4.2.1/icu4c-4_2_1-src.tgz">http://download.icu-project.org/files/icu4c/4.2.1/icu4c-4_2_1-src.tgz</a>     $ tar xvzf icu4c-4_2_1-src.tgz
$ cd icu/source
$ ./runConfigureICU MacOSX --with-library-bits=64 --disable-samples --enable-static # if this fails for you try: ./configure --enable-64bit-libs
$ make
$ sudo make install</p>
</li>
</ol>
<p>I couldn't get the above to work on 64bit Snow Leopard 10.6.3, but I did find a fix for the configure file that will make it compile in 64bit correctly.</p>
<div class="codehilite"><pre><span class="o">-</span> <span class="o">*-</span><span class="n">arch</span><span class="o">*</span><span class="n">ppc</span><span class="o">*|*-</span><span class="n">arch</span><span class="o">*</span><span class="n">i386</span><span class="o">*|*-</span><span class="n">arch</span><span class="o">*</span><span class="n">x86_64</span><span class="o">*</span><span class="p">)</span> <span class="n">ac_cv_c_bigendian</span><span class="o">=</span><span class="n">universal</span><span class="p">;;</span>
<span class="o">+</span> <span class="o">*-</span><span class="n">arch</span><span class="o">*</span><span class="n">ppc</span><span class="o">*</span><span class="p">)</span> <span class="n">ac_cv_c_bigendian</span><span class="o">=</span><span class="n">yes</span><span class="p">;;</span>
</pre></div>


<p>find the first line with the - in configure and replace it with the second line with the +
in the ICU 4.4.1 release this line is at 8002, if Erlang is compiled with 64bit and you patch the ICU configure to compile in 64bit then CouchDB will build and run correctly on 64bit OSX 10.6.x</p>
<ol>
<li>Install SpiderMonkey</li>
</ol>
<p>We need <a href="http://svn.macports.org/repository/macports/trunk/dports/lang/spidermonkey/files/patch-jsprf.c">jsprf patch</a> from the MacPorts project to install SpiderMonkey.</p>
<div class="codehilite"><pre>$ curl -O <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://ftp.mozilla.org/pub/mozilla.org/js/js-1.7.0.tar.gz&quot;</span><span class="nt">&gt;</span>http://ftp.mozilla.org/pub/mozilla.org/js/js-1.7.0.tar.gz<span class="nt">&lt;/a&gt;</span>     $ curl -O <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://svn.macports.org/repository/macports/trunk/dports/lang/spidermonkey/files/patch-jsprf.c&quot;</span><span class="nt">&gt;</span>http://svn.macports.org/repository/macports/trunk/dports/lang/spidermonkey/files/patch-jsprf.c<span class="nt">&lt;/a&gt;</span>     $ tar xvzf <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;js-1.7.0.tar.gz&quot;</span><span class="nt">&gt;</span>js-1.7.0.tar.gz<span class="nt">&lt;/a&gt;</span>     $ cd js/src
$ patch -p0 -i ../../patch-jsprf.c
$ make -f Makefile.ref
$ sudo su
$ JS_DIST=/usr/local/spidermonkey make -f Makefile.ref export
$ exit
$ sudo ranlib /usr/local/spidermonkey/lib/libjs.a
</pre></div>


<p><strong>NOTE:</strong> You may receive the following warning. You should be safe to ignore it and proceed with the instructions.</p>
<div class="codehilite"><pre><span class="err">ranlib:</span> <span class="err">file:</span> <span class="err">/usr/local/spidermonkey/lib/libjs.a(jslock.o)</span> <span class="err">has</span> <span class="err">no</span> <span class="err">symbols</span>
</pre></div>


<h4 id="using-dyld_library_path">Using DYLD_LIBRARY_PATH</h4>
<p>add to your .profile this line :</p>
<div class="codehilite"><pre><span class="n">export</span> <span class="n">DYLD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$DYLD_LIBRARY_PATH:</span><span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/spidermonkey/</span><span class="n">lib</span>
</pre></div>


<p>then reload your env :</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="err">.</span> <span class="err">~/.</span><span class="nv">profile</span>
</pre></div>


<h4 id="avoding-dyld_library_path">Avoding DYLD_LIBRARY_PATH</h4>
<p>Not using DYLD_LIBRARY_PATH means that you don't need to worry about setting the environment for other users (ie, the couchdb user or root). Also, it avoids the need to tell the CouchDB ./configure script where to find spidermonkey.</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/spidermonkey/i</span><span class="n">nclude</span> <span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/include/</span><span class="n">js</span>
<span class="nv">$</span> <span class="nv">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/spidermonkey/</span><span class="n">lib</span><span class="sr">/libjs.dylib /</span><span class="n">usr</span><span class="sr">/local/</span><span class="n">lib</span><span class="o">/</span><span class="n">libjs</span><span class="o">.</span><span class="n">dylib</span>
<span class="o">&lt;!--</span> <span class="c1"># If you&#39;re feeling saucey, the js shell can be useful for quick syntax checking and the like. --&gt;</span>

<span class="nv">$</span> <span class="nv">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/spidermonkey/</span><span class="n">bin</span><span class="sr">/js /</span><span class="n">usr</span><span class="sr">/local/</span><span class="n">bin</span><span class="o">/</span><span class="n">js</span>
</pre></div>


<ol>
<li>
<p>Install Erlang R13B01</p>
<p>$ curl -O <a href="http://erlang.org/download/otp_src_R13B01.tar.gz">http://erlang.org/download/otp_src_R13B01.tar.gz</a>     $ tar xvzf <a href="otp_src_R13B01.tar.gz">otp_src_R13B01.tar.gz</a>     $ cd otp_src_R13B01/
$ ./configure --enable-smp-support --enable-dynamic-ssl-lib --enable-kernel-poll --enable-darwin-64bit
$ make
$ sudo make install</p>
</li>
<li>
<p>Building CouchDB:</p>
</li>
</ol>
<p>We will install it from the trunk, but installation from released source should work</p>
<div class="codehilite"><pre>$ svn co <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://svn.apache.org/repos/asf/couchdb/trunk&quot;</span><span class="nt">&gt;</span>http://svn.apache.org/repos/asf/couchdb/trunk<span class="nt">&lt;/a&gt;</span> couchdb
$ cd couchdb
$ ./bootstrap <span class="err">&amp;&amp;</span> ./configure --with-js-include=/usr/local/spidermonkey/include --with-js-lib=/usr/local/spidermonkey/lib
$ make
</pre></div>


<h4 id="note">NOTE</h4>
<p>If you avoided using DYLD_LIBRARY_PATH when installing spidermonkey, you won't need to use the --with-js-[include|lib] flags.</p>
<ol>
<li>Running</li>
</ol>
<p>If you want to install run <code>make install</code> . For developement use do :</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">make</span> <span class="n">dev</span>
<span class="nv">$</span> <span class="err">./</span><span class="nv">utils</span><span class="o">/</span><span class="n">run</span>
</pre></div>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>