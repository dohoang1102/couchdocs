<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Installing_on_Windows</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <p>&lt;<TableOfContents>&gt;</p>
<p>This page describes how to build and install couchdb from source on Windows.  See also the <a class="internal" href="Windows_binary_installer.html">Windows_binary_installer</a>.</p>
<h1 id="building-current-couchdb-versions">Building current couchdb versions</h1>
<p>As of couchdb 0.10, support for Windows is included in the standard build process.  View <a href="http://svn.apache.org/viewvc/couchdb/trunk/README?view=co">README</a> in the root of the source tree for information about the dependencies and how to configure the build process.  In summary, you will need to:</p>
<ul>
<li>
<p>Install the cygwin environment.</p>
</li>
<li>
<p>Install the MS C compiler.</p>
</li>
<li>
<p>Install and possibly build a number of pre-requisites, such as curl, icu, seamonkey, etc.</p>
</li>
<li>
<p>get the sources to erlang and couch</p>
</li>
<li>
<p>configure and build erlang according to the instructions.</p>
</li>
<li>
<p>configure and build couch according to the <a href="http://svn.apache.org/viewvc/couchdb/trunk/README?view=co">README</a> file in couch</p>
</li>
</ul>
<p>After executing 'make install', you will find a couchdb directory structure inside your erlang directory - that is, the couch build process simply installs its libraries into the erlang binaries you previously build.  This directory structure should be ready to roll - it can be zipped up, packaged by an installer, etc.</p>
<h1 id="older-instructions">Older instructions</h1>
<p>These instructions are for couch versions pre 0.10</p>
<p>There is a <a class="internal" href="Windows_binary_installer.html">Windows_binary_installer</a> in "beta testing". See the wiki page for it for more instructions.</p>
<p>CouchDB does not natively install on Windows but it is possible to install it by hand. '''Be aware that many unit tests fail due to IO-related features that aren't supported by Erlang on Windows.'''</p>
<p>Please update this guide as needed, we aim to collect feedback and roll the procedure into the official build.</p>
<p>These instructions currently refer to paths as they'd be set up in a default installation of Erlang OTP 5.7.1, with the couchDB distribution installed at</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span>
</pre></div>


<h2 id="dependencies">Dependencies</h2>
<p>You will need the following software installed on your system:</p>
<ul>
<li><a href="http://www.erlang.org/download.html">Erlang/OTP</a></li>
<li>C Compiler/Linker (such as <a href="http://gcc.gnu.org/">GCC</a> or <a href="http://msdn.microsoft.com/en-us/visualc/default.aspx">Visual C++</a>)</li>
<li>Make (such as <a href="http://www.gnu.org/software/make/">GNU Make</a> or <a href="http://msdn.microsoft.com/en-us/library/dd9y37ha(VS.71).aspx">nmake</a>)</li>
<li><a href="http://www.openssl.org/">OpenSSL</a></li>
<li><a href="http://www.icu-project.org/">ICU</a> (Tested with <a href="http://www.icu-project.org/download/4.0.html">binary build of 4.2 release</a>.)</li>
<li><a href="http://www.mozilla.org/js/spidermonkey/">SpiderMonkey</a></li>
</ul>
<h2 id="install-couchdb-as-an-erlang-library-directory">Install CouchDB as an Erlang Library Directory</h2>
<p>After installing Erlang you should having something similar to:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span>
</pre></div>


<p>Copy the whole CouchDB source tree to:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span>
</pre></div>


<p>Make the following empty directories:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">mochiweb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mo">01</span><span class="o">\</span><span class="n">ebin</span>

<span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">\</span><span class="n">ebin</span>
</pre></div>


<h2 id="provide-icu-to-erlang">Provide ICU to Erlang</h2>
<p>From ICU copy <code>icu*.dll</code> (and <code>libeay32.dll</code> for older versions of ICU) to:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">erts</span><span class="o">-</span><span class="mi">5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">bin</span>
</pre></div>


<h2 id="build-spidermonkey">Build SpiderMonkey</h2>
<p>The SpiderMonkey distribution's Windows build stuff is broken. See <a href="http://blog.endflow.net/?p=55&lang=en">this blog post</a> for a working js.mak file. Don't bother trying to import the project file into a contemporary Visual Studio; just use the Visual Studio command line tools with the js.mak file referred to above.</p>
<p>CouchDB uses a custom JavaScript driver, which provides unicode and buffering improvements. In the !SpiderMonkey distribution, rename src/js.c to src/js.c.bak, and copy <code>C:\Program Files\erl5.6.3\lib\couchdb-0.8.1\src\couchdb\couch_js.c</code> from the CouchDB distribution to src/js.c in the !SpiderMonkey distribution. Before running nmake, edit the new js.c and change <code>#include &lt;jsapi.h&gt;</code> to <code>#include "jsapi.h"</code>.</p>
<p>Once you've built js.exe and js32.dll, copy them both to</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">erts</span><span class="o">-</span><span class="mi">5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">bin</span>
</pre></div>


<p>and rename js.exe to couch_js.exe.</p>
<p><em>Here are the binaries built according to the blog post: <a href="http://dl.getdropbox.com/u/118385/CouchDbBinaries/couchbd_spidermonkey_1.7_win32_32bit.zip">couchbd_spidermonkey_1.7_win32_32bit.zip</a> . Just unzip the contents to the bin directory.</em></p>
<h2 id="build-couchdbcouch_erl_driverc">Build couchdb/couch_erl_driver.c</h2>
<p>This is a wrapper to provide ICU features to CouchDB.</p>
<p><em>Here is a binary (no worry! MS bleeding-edge technology proved!) built against ICU 4.2 in 32-bit Windows: [[attachment:couch_erl_driver.dll]]</em></p>
<p>The simplest way to build a DLL is to create a Win32 DLL project in an IDE, add <code>couch_erl_driver.c</code> into the project, and change project settings to include the Erlang ERTS and ICU4C header paths. </p>
<p>You must also include the various ICU <code>*.lib</code> files to the MSVC linker as inputs. MSVC doesn't know how to create a DLL with unresolved names.  In Visual Studio 2008 this can be accomplished by right clicking on the project, choosing properties, expanding the Linker node in the left panel, selecting Input, and adding the following to the 'Additional Dependencies' field:</p>
<p><em>icudt.lib 
 </em>icuin.lib 
 <em>icuio.lib 
 </em>icule.lib 
 <em>iculx.lib 
 </em>icutu.lib 
 *icuuc.lib </p>
<p>The erlang include paths for this build for example were </p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">otp_src_R13B</span><span class="o">\</span><span class="n">erts</span><span class="o">\</span><span class="n">emulator</span><span class="o">\</span><span class="n">sys</span><span class="o">\</span><span class="n">win32</span> 
<span class="n">C:</span><span class="o">\</span><span class="n">otp_src_R13B</span><span class="o">\</span><span class="n">erts</span><span class="o">\</span><span class="n">emulator</span><span class="o">\</span><span class="n">beam</span>
</pre></div>


<p>Make the following empty directory:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">\</span><span class="n">priv</span>
</pre></div>


<p>Copy the DLL to:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">\</span><span class="n">priv</span><span class="o">\</span><span class="n">couch_erl_driver</span><span class="o">.</span><span class="n">dll</span>
</pre></div>


<h2 id="erlang-compilation">Erlang Compilation</h2>
<p>Create a the following file:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">\</span><span class="n">src</span><span class="o">\</span><span class="n">Emakefile</span>
</pre></div>


<p>Add the following content:</p>
<div class="codehilite"><pre><span class="p">{</span><span class="s">&#39;./couchdb/*&#39;</span><span class="p">,</span> <span class="p">[{</span><span class="n">outdir</span><span class="p">,</span><span class="s">&quot;../ebin&quot;</span><span class="p">}]}</span><span class="o">.</span>
<span class="p">{</span><span class="s">&#39;./mochiweb/*&#39;</span><span class="p">,</span> <span class="p">[{</span><span class="n">outdir</span><span class="p">,</span><span class="s">&quot;../../mochiweb-0.01/ebin&quot;</span><span class="p">}]}</span><span class="o">.</span>
</pre></div>


<p>Launch <code>erl</code> (or <code>werl</code>) and execute the following command to change working directory:</p>
<div class="codehilite"><pre><span class="n">cd</span><span class="p">(</span><span class="s">&quot;C:/Program Files/erl5.7.1/lib/apache-couchdb-0.9.0/src&quot;</span><span class="p">)</span><span class="o">.</span>
</pre></div>


<p>Execute this command to compile CouchDB:</p>
<div class="codehilite"><pre><span class="err">make:all().</span>
</pre></div>


<h2 id="configuring">Configuring</h2>
<p>Copy the following file:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="o">\</span><span class="n">Program</span> <span class="n">Files</span><span class="o">\</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="o">\</span><span class="n">lib</span><span class="o">\</span><span class="n">apache</span><span class="o">-</span><span class="n">couchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">\</span><span class="n">etc</span><span class="o">\</span><span class="n">couchdb</span><span class="o">\</span><span class="n">default</span><span class="o">.</span><span class="n">ini</span><span class="o">.</span><span class="n">tpl</span><span class="o">.</span><span class="n">in</span>
</pre></div>


<p>To this location:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="sr">/Program Files/</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="sr">/bin/</span><span class="n">default</span><span class="o">.</span><span class="n">ini</span>
</pre></div>


<p>or to this location:</p>
<div class="codehilite"><pre><span class="n">C:</span><span class="sr">/Program Files/</span><span class="n">erl5</span><span class="o">.</span><span class="mi">7</span><span class="o">.</span><span class="mi">1</span><span class="sr">/lib/co</span><span class="n">uchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">ini</span>
</pre></div>


<p>Edit the file to look something like this:</p>
<div class="codehilite"><pre><span class="k">[couchdb]</span>
<span class="na">database_dir</span> <span class="o">=</span> <span class="s">c:/data/couch</span>
<span class="na">view_index_dir</span> <span class="o">=</span> <span class="s">c:/data/couch</span>
<span class="na">util_driver_dir</span> <span class="o">=</span> <span class="s">C:/Program Files/erl5.7.1/lib/apache-couchdb-0.9.0/priv</span>
<span class="na">ConsoleStartupMsg</span><span class="o">=</span><span class="s">Apache CouchDB is starting.</span>
<span class="na">max_document_size</span> <span class="o">=</span> <span class="s">4294967296 ; 4 GB</span>
<span class="na">max_attachment_chunk_size</span> <span class="o">=</span> <span class="s">4294967296 ; 4GB</span>
<span class="na">os_process_timeout</span> <span class="o">=</span> <span class="s">5000 ; 5 seconds. for view and external servers.</span>
<span class="na">max_dbs_open</span> <span class="o">=</span> <span class="s">100</span>

<span class="k">[httpd]</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">5984</span>
<span class="na">bind_address</span> <span class="o">=</span> <span class="s">127.0.0.1</span>
<span class="na">authentication_handler</span> <span class="o">=</span> <span class="s">{couch_httpd, default_authentication_handler}</span>
<span class="na">WWW-Authenticate</span> <span class="o">=</span> <span class="s">Basic realm=&quot;administrator&quot;</span>

<span class="k">[log]</span>
<span class="na">file</span> <span class="o">=</span> <span class="s">c:/logs/couch.log</span>
<span class="na">level</span> <span class="o">=</span> <span class="s">info</span>

<span class="k">[daemons]</span>
<span class="na">view_manager</span><span class="o">=</span><span class="s">{couch_view, start_link, []}</span>
<span class="na">external_manager</span><span class="o">=</span><span class="s">{couch_external_manager, start_link, []}</span>
<span class="na">db_update_notifier</span><span class="o">=</span><span class="s">{couch_db_update_notifier_sup, start_link, []}</span>
<span class="na">query_servers</span><span class="o">=</span><span class="s">{couch_query_servers, start_link, []}</span>
<span class="na">httpd</span><span class="o">=</span><span class="s">{couch_httpd, start_link, []}</span>
<span class="na">stats_aggregator</span><span class="o">=</span><span class="s">{couch_stats_aggregator, start, []}</span>
<span class="na">stats_collector</span><span class="o">=</span><span class="s">{couch_stats_collector, start, []}</span>

<span class="k">[httpd_global_handlers]</span>
<span class="na">/</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_welcome_req, &lt;&lt;&quot;Welcome&quot;&gt;&gt;}</span>
<span class="na">favicon.ico</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_favicon_req, &quot;C:/Program Files/erl5.7.1/lib/apache-couchdb-0.9.0/share/www&quot;}</span>

<span class="na">_utils</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_utils_dir_req, &quot;C:/Program Files/erl5.7.1/lib/apache-couchdb-0.9.0/share/www&quot;}</span>
<span class="na">_all_dbs</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_all_dbs_req}</span>
<span class="na">_active_tasks</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_task_status_req}</span>
<span class="na">_config</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_config_req}</span>
<span class="na">_replicate</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_replicate_req}</span>
<span class="na">_uuids</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_uuids_req}</span>
<span class="na">_restart</span> <span class="o">=</span> <span class="s">{couch_httpd_misc_handlers, handle_restart_req}</span>
<span class="na">_stats</span> <span class="o">=</span> <span class="s">{couch_httpd_stats_handlers, handle_stats_req}</span>

<span class="k">[httpd_db_handlers]</span>
<span class="na">_design</span> <span class="o">=</span> <span class="s">{couch_httpd_db, handle_design_req}</span>
<span class="na">_temp_view</span> <span class="o">=</span> <span class="s">{couch_httpd_view, handle_temp_view_req}</span>

<span class="k">[httpd_design_handlers]</span>
<span class="na">_view</span> <span class="o">=</span> <span class="s">{couch_httpd_view, handle_view_req}</span>
<span class="na">_show</span> <span class="o">=</span> <span class="s">{couch_httpd_show, handle_doc_show_req}</span>
<span class="na">_list</span> <span class="o">=</span> <span class="s">{couch_httpd_show, handle_view_list_req}</span>
</pre></div>


<p>Make sure that the <code>database_dir</code> exists and that the <code>LogFile</code> can be created.</p>
<h2 id="running">Running</h2>
<p>Launch <code>erl</code> (or <code>werl</code>) and execute the following command:</p>
<div class="codehilite"><pre><span class="err">couch_server:start().</span>
</pre></div>


<p>If you encounter any trouble, set the log 'level' to 'debug' in default.ini</p>
<p>To check that everything has worked point your web browser to
<a href="http">http</a> and run the test suite.</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>