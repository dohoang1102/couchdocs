<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Runtime_Statistics</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#get-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <p>Note, this applies to CouchDB 0.9 and newer.</p>
<p>CouchDB comes with a runtime statistics module that lets you inspect how CouchDB performs. The statistics module collects metrics like requests per second, request sizes and a multitude of other useful stuff.</p>
<p>You can get a list of all currently counted metrics by issuing a GET request to</p>
<div class="codehilite"><pre><span class="o">/</span><span class="n">_stats</span>
</pre></div>


<p>and CouchDB will return</p>
<div class="codehilite"><pre><span class="p">{</span>
  <span class="s">&quot;couchdb&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;request_time&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;current&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;length of a request inside CouchDB without Mochiweb&quot;</span><span class="p">,</span>
      <span class="s">&quot;stddev&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;count&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;httpd_request_methods&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;GET&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;current&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">000</span><span class="mi">96946194861852</span><span class="p">,</span>
      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;number of HTTP GET requests&quot;</span><span class="p">,</span>
      <span class="s">&quot;stddev&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">0311210</span><span class="mi">875797858</span><span class="p">,</span>
      <span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;count&quot;</span><span class="p">:</span> <span class="mi">2063</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;httpd&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;requests&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;current&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">000</span><span class="mi">96946194861852</span><span class="p">,</span>
      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;number of HTTP requests&quot;</span><span class="p">,</span>
      <span class="s">&quot;stddev&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">0311210</span><span class="mi">875797858</span><span class="p">,</span>
      <span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;count&quot;</span><span class="p">:</span> <span class="mi">2063</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s">&quot;httpd_status_codes&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;200&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;current&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">000</span><span class="mi">96946194861852</span><span class="p">,</span>
      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;number of HTTP 200 OK responses&quot;</span><span class="p">,</span>
      <span class="s">&quot;stddev&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">0311210</span><span class="mi">875797858</span><span class="p">,</span>
      <span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;count&quot;</span><span class="p">:</span> <span class="mi">2063</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Your output may vary. Depending on the number and type of requests CouchDB has processed so far, the output will include more or less metrics. Let's break the above down for a bit.</p>
<p>Statistics are reported by 'group'. Often the group is just the couchdb module that counted the metric (<code>httpd</code> for the HTTP API for example), or it is a subgroup within a module, like <code>httpd_status_codes</code>. Each group or subgroup contains one or more 'keys'. Keys are unique identifies for a single metric in a module. The combination of group and key (<code>{httpd, requests}</code>) uniquely identifies a single metric.</p>
<p>Each metric is aggregated over four periods time. In the default output of <code>/_stats</code> the period of time is since CouchDB was started. The aggregate values are calculated on a per-second basis. So values <code>{httpd, requests}</code> will include the number of requests made against the HTTP API per second since CouchDB was started. <code>current</code> is the current value, the number of requests. <code>max</code> and <code>min</code> are the respective extreme values and <code>mean</code> is arithmetic mean value for the period of time with a standard deviation of <code>steddev</code>. <code>description</code> is a human-readable description of the metric and <code>count</code> is the number of times this metric was counted.</p>
<p>The three other periods of time are 60 seconds, 300, and 900 seconds (1, 5, 15 minutes). The aggregate values for these periods are reset at the end of each period and begin to count anew.</p>
<p>You can grab single statistics by querying</p>
<div class="codehilite"><pre><span class="sr">/_stats/g</span><span class="n">roup</span><span class="o">/</span><span class="n">key</span>
</pre></div>


<p>for example</p>
<div class="codehilite"><pre><span class="sr">/_stats/</span><span class="n">httpd</span><span class="o">/</span><span class="n">requests</span>
</pre></div>


<p>and the response will include only the aggregate values for this single metric.</p>
<div class="codehilite"><pre><span class="p">{</span>
  <span class="s">&quot;httpd&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s">&quot;requests&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s">&quot;current&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
      <span class="s">&quot;max&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s">&quot;mean&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">000</span><span class="mi">978154548418653</span><span class="p">,</span>
      <span class="s">&quot;description&quot;</span><span class="p">:</span> <span class="s">&quot;number of HTTP requests&quot;</span><span class="p">,</span>
      <span class="s">&quot;stddev&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="o">.</span><span class="mo">031260162541133</span><span class="p">,</span>
      <span class="s">&quot;min&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">&quot;count&quot;</span><span class="p">:</span> <span class="mi">3067</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>If you want to query a different time period, use the <code>?range=60</code> (or <code>300</code> or <code>900</code>). You won't get useful results if you query any other time range and you can't yet configure the different time ranges.</p>
<p>If you are parsing the responses into native objects in your programming language, you can simply access all the aggregate values using the object-attribute accessor method of your language. Here is an example for JavaScript.</p>
<div class="codehilite"><pre>  <span class="sr">//</span> <span class="sb">`var stats`</span> <span class="n">is</span> <span class="n">filled</span> <span class="n">with</span> <span class="n">an</span> <span class="n">XMLHttpRequest</span><span class="o">.</span>
  <span class="n">alert</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">httpd</span><span class="o">.</span><span class="n">requests</span><span class="o">.</span><span class="n">max</span><span class="p">);</span>
</pre></div>


<p>At the moment the following list of metrics is collected; it might expand in the future:</p>
<div class="codehilite"><pre><span class="p">{</span><span class="n">couchdb</span><span class="p">,</span> <span class="n">database_writes</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">times</span> <span class="n">a</span> <span class="n">database</span> <span class="n">was</span> <span class="n">changed</span><span class="p">}</span>
<span class="p">{</span><span class="n">couchdb</span><span class="p">,</span> <span class="n">database_reads</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">times</span> <span class="n">a</span> <span class="n">document</span> <span class="n">was</span> <span class="nb">read</span> <span class="n">from</span> <span class="n">a</span> <span class="n">database</span><span class="p">}</span>
<span class="p">{</span><span class="n">couchdb</span><span class="p">,</span> <span class="n">open_databases</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="nb">open</span> <span class="n">databases</span><span class="p">}</span>
<span class="p">{</span><span class="n">couchdb</span><span class="p">,</span> <span class="n">open_os_files</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">file</span> <span class="n">descriptors</span> <span class="n">CouchDB</span> <span class="n">has</span> <span class="nb">open</span><span class="p">}</span>
<span class="p">{</span><span class="n">couchdb</span><span class="p">,</span> <span class="n">request_time</span><span class="p">},</span> <span class="nb">length</span> <span class="n">of</span> <span class="n">a</span> <span class="n">request</span> <span class="n">inside</span> <span class="n">CouchDB</span> <span class="n">without</span> <span class="n">MochiWeb</span><span class="p">}</span>

<span class="p">{</span><span class="n">httpd</span><span class="p">,</span> <span class="n">bulk_requests</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">bulk</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd</span><span class="p">,</span> <span class="n">requests</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd</span><span class="p">,</span> <span class="n">temporary_view_reads</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">temporary</span> <span class="n">view</span> <span class="n">reads</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd</span><span class="p">,</span> <span class="n">view_reads</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">view</span> <span class="n">reads</span><span class="p">}</span>

<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;COPY&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">COPY</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;DELETE&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">DELETE</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;GET&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">GET</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;HEAD&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">HEAD</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;MOVE&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">MOVE</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">POST</span> <span class="n">requests</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_request_methods</span><span class="p">,</span> <span class="s">&#39;PUT&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="n">PUT</span> <span class="n">requests</span><span class="p">}</span>

<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;200&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">200</span> <span class="n">OK</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;201&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">201</span> <span class="n">Created</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;202&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">202</span> <span class="n">Accepted</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;301&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;304&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">304</span> <span class="n">Not</span> <span class="n">Modified</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;400&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">400</span> <span class="n">Bad</span> <span class="n">Request</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;401&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">401</span> <span class="n">Unauthorized</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;403&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">403</span> <span class="n">Forbidden</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;404&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">404</span> <span class="n">Not</span> <span class="n">Found</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;405&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">405</span> <span class="n">Method</span> <span class="n">Not</span> <span class="n">Allowed</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;409&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">409</span> <span class="n">Conflict</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;412&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">412</span> <span class="n">Precondition</span> <span class="n">Failed</span> <span class="n">responses</span><span class="p">}</span>
<span class="p">{</span><span class="n">httpd_status_codes</span><span class="p">,</span> <span class="s">&#39;500&#39;</span><span class="p">},</span> <span class="n">number</span> <span class="n">of</span> <span class="n">HTTP</span> <span class="mi">500</span> <span class="n">Internal</span> <span class="n">Server</span> <span class="n">Error</span> <span class="n">responses</span><span class="p">}</span>
</pre></div>


<hr />
<h2 id="questions-about-statistics-from-the-mailing-list">Questions about Statistics from the mailing list</h2>
<h3 id="what-exactly-is-current-count-what-are-each-of-them-recording-and-why-is-count-less-than-current-in-my-system-seems-counter-intuitive-to-me">What exactly is 'current' &amp; 'count'. What are each of them recording   and why is 'count' less than 'current' in my system (seems counter intuitive    to me).</h3>
<p>Current is a sum of the values recorded. For things like HTTP requests, this is the total number of requsts.</p>
<p>Count is the number of updates for this metric in the given time span.</p>
<p>Stats works with two parts, a collector and an aggregator. The collector part receives messages from through out CouchDB and holds that data in a table. Once a second the aggregator will sweep through the collector and update its stats.</p>
<p>So, if you had 20K requests between to aggregator sweeps, Current would be incremented by 20K and Count is incremented by 1.</p>
<h3 id="can-the-mean-here-be-interpreted-as-average-reads-per-second">Can the 'mean' here be interpreted as average reads per second?</h3>
<p>For requests, the mean is roughly the requests per second. Its not as theoretically correct as something like RRDtool because we don't interpolate, we just average the reads we take roughly once a second.</p>
<h3 id="is-there-any-indication-of-exactly-where-within-the-5-minute-interval-we-are">Is there any indication of exactly where within the 5 minute interval    we are?</h3>
<p>No, but the current implementation (committed after 0.10.x was branched) does not reset statistic aggregators as the old code did. The new method is the more standard "these stats reflect all values seen in the last 5 minutes" regardless of when you query it.</p>
<h2 id="another-metric-that-im-having-trouble-with-is-the-request_time-querying-it-returns-data-similar-to">Another metric that I'm having trouble with is the 'request_time'. Querying it returns data similar to:</h2>
<p>[snip]</p>
<h3 id="again-same-question-about-exactly-what-the-count-and-current-values-mean-for-this-metric">Again, same question about exactly what the 'count' and 'current'    values mean for this metric.</h3>
<p>Oh weird. So, Count has the same meaning as before, but here Current is the length of the last recorded request. The weirdness comes from the fact that this is averaging a set of distinct points, where as things like requests are averaging the relative change so current makes a bit more sense there.</p>
<h3 id="does-the-mean-represent-the-average-time-for-a-request-in-couchdb-in-seconds">Does the 'mean' represent the average time for a request in CouchDB in   seconds?</h3>
<p>milliseconds.</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>