<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Vues</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <!-- #language fr -->

<p>Ce doccument est une simple introduction des vues CouchDB.</p>
<h2 id="concept">Concept</h2>
<p>Les vues sont l'outil de base pour interroger et reporter des documents CouchDB. Il y a deux types de vues : les vues permanentes et temporaires.</p>
<p>Les <strong>vues permanentes</strong> sont stockées au sein de documents spéciaux appelés documents design et sont accessibles via une requête HTTP <em>GET</em> sur l'URI <em>/{dbname}/{docid}/{viewname}</em>, où <em>{docid}</em> a le préfixe  <em>_view/</em> afin que CouchDB le reconnaisse comme un document design.</p>
<p>Les <strong>vues temporaires</strong> ne sont pas enregistrées dans la base de données, mais executées à la demande. Pour exécuter une vue temporaire vous envoyez  HTTP <em>POST</em> à l'URI <em>/{dbname}/_temp_view</em>, où le corps de cette requête contient le code de la vue et l'entête <em>Content-Type</em> est fixée à <em>application/json</em>.</p>
<p>Pour les deux types de vues, on définit la vue par une fonction !JavaScript qui associe (map) les cles de la vue à leurs valeurs (il est néanmoins possible d'utiliser un autre langage que !JavaScript en utilisant un serveur de vue tiers.).</p>
<p>Attention, par défaut, les vues ne sont pas crées ni mises à jour lorsqu'un document est enregistré mais lorsqu'elles sont appelées. Le premier accès pourra donc prendre quelques temps en fonction de la taille des données, le temps que CouchDB crée la vue. Il est préférable de mettre à jour les vues après qu'un documents soit sauvé en utilisant un script externe appelées lors de la mise à jour des vues. Un exemple peut être touvée ici : RegénérationVuesÀlaMiseAjour.</p>
<p>Notez, que toutes les vues d'un document design sont mises à jour lorsque l'une des vues de celui-ci est appelée.</p>
<p>Attention changement API !JavaScript : Avant le Jeudi 20 mai 2008 (révision subversion r658405) la fonction pour émettre une ligne dans l'index d'associations (map) était nommée "map". Elle a été renommée "emit".</p>
<h2 id="bases">Bases</h2>
<p>Voici un simple exemple d'une fonction de vue :</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">emit</span><span class="p">(</span><span class="n">null</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Cette fonction définit une table contenant tous les document dans la base de donnée CouchDB sans clé particulière.</p>
<p>Une fonction vue accepte un seul argument : l'objet document. Pour produire un résultat, elle doit appeler la fonction disponible implicitement  <em>emit(key, value)</em>. À chaque appel de cette fonction, une ligne est ajoutée à la vue (si ni la <em>clé</em>(key) ni la <em>valeur</em>(value) sont indéfinies(undefined)). Quand les documents sont ajoutés, modifiés ou supprimés, les lignes de cette table sont mises à jour automatiquement.</p>
<p>Voici un exemple plus complexe d'une fonction définisant une vue sur les valeurs recupérées dans les documents des clients :</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&quot;customer&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">null</span><span class="p">,</span> <span class="p">{</span><span class="n">LastName:</span> <span class="n">doc</span><span class="o">.</span><span class="n">LastName</span><span class="p">,</span> <span class="n">FirstName:</span> <span class="n">doc</span><span class="o">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Address:</span> <span class="n">doc</span><span class="o">.</span><span class="n">Address</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Pour chaque document de la base de donnée dont le champ Type a la valeur <em>customer</em>, une ligne est crée dans la vue. La colonne <em>value </em>de la vue contient les champs<em>!LastName</em>, <em>!FirstName</em>, and <em>Address</em>  pour chaque document. La clé pour tous les documents est null dans ce cas.</p>
<p>Afin de pouvoir filtrer ou trier les documents par propriété, vous devez utiliser celle-ci pour la clé. Par exemple, la vue suivante va permettre de chercher les documents des clients par les champs <em>!LastName</em> ou <em>!FirstName</em> :</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">Type</span> <span class="o">==</span> <span class="s">&quot;customer&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">LastName</span><span class="p">,</span> <span class="p">{</span><span class="n">FirstName:</span> <span class="n">doc</span><span class="o">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">Address:</span> <span class="n">doc</span><span class="o">.</span><span class="n">Address</span><span class="p">});</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="p">{</span><span class="n">LastName:</span> <span class="n">doc</span><span class="o">.</span><span class="n">LastName</span><span class="p">,</span> <span class="n">Address:</span> <span class="n">doc</span><span class="o">.</span><span class="n">Address</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Le résultat d'une telle vue est le suivant :</p>
<div class="codehilite"><pre><span class="p">{</span>
   <span class="s">&quot;total_rows&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
   <span class="s">&quot;offset&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
   <span class="s">&quot;rows&quot;</span><span class="p">:</span>
   <span class="p">[</span>
     <span class="p">{</span>
       <span class="s">&quot;id&quot;</span><span class="p">:</span><span class="s">&quot;64ACF01B05F53ACFEC48C062A5D01D89&quot;</span><span class="p">,</span>
       <span class="s">&quot;key&quot;</span><span class="p">:</span><span class="s">&quot;Katz&quot;</span><span class="p">,</span>
       <span class="s">&quot;value&quot;</span><span class="p">:{</span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="s">&quot;Damien&quot;</span><span class="p">,</span> <span class="s">&quot;Address&quot;</span><span class="p">:</span><span class="s">&quot;2407 Sawyer drive, Charlotte NC&quot;</span><span class="p">}</span>
     <span class="p">},</span>
     <span class="p">{</span>
       <span class="s">&quot;id&quot;</span><span class="p">:</span><span class="s">&quot;64ACF01B05F53ACFEC48C062A5D01D89&quot;</span><span class="p">,</span>
       <span class="s">&quot;key&quot;</span><span class="p">:</span><span class="s">&quot;Damien&quot;</span><span class="p">,</span>
       <span class="s">&quot;value&quot;</span><span class="p">:{</span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="s">&quot;Katz&quot;</span><span class="p">,</span> <span class="s">&quot;Address&quot;</span><span class="p">:</span><span class="s">&quot;2407 Sawyer drive, Charlotte NC&quot;</span><span class="p">}</span>
     <span class="p">},</span>
     <span class="p">{</span>
       <span class="s">&quot;id&quot;</span><span class="p">:</span><span class="s">&quot;5D01D8964ACF01B05F53ACFEC48C062A&quot;</span><span class="p">,</span>
       <span class="s">&quot;key&quot;</span><span class="p">:</span><span class="s">&quot;Kerr&quot;</span><span class="p">,</span>
       <span class="s">&quot;value&quot;</span><span class="p">:{</span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="s">&quot;Wayne&quot;</span><span class="p">,</span> <span class="s">&quot;Address&quot;</span><span class="p">:</span><span class="s">&quot;123 Fake st., such and such&quot;</span><span class="p">}</span>
     <span class="p">},</span>
     <span class="p">{</span>
       <span class="s">&quot;id&quot;</span><span class="p">:</span><span class="s">&quot;5D01D8964ACF01B05F53ACFEC48C062A&quot;</span><span class="p">,</span>
       <span class="s">&quot;key&quot;</span><span class="p">:</span><span class="s">&quot;Wayne&quot;</span><span class="p">,</span>
       <span class="s">&quot;value&quot;</span><span class="p">:{</span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="s">&quot;Kerr&quot;</span><span class="p">,</span> <span class="s">&quot;Address&quot;</span><span class="p">:</span><span class="s">&quot;123 Fake st., such and such&quot;</span><span class="p">}</span>
     <span class="p">},</span>
   <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p><em>Cet exemple a été reformaté pour le rendre plus lisible.</em></p>
<h2 id="vues-de-recherche">Vues de recherche</h2>
<p>Le second paramètre d'une fonction <em>emit()</em> peut être <em>NULL</em>. CouchDB stocke alors seulement les clés dans la vue. Il est aussi possible de retourner l'ID du document à la place de <em>NULL</em>, ce qui permet d'utiliser la vue comme un mécanisme de recherche compact, pour récupérer les détails du document dans d'autres requêtes.</p>
<h2 id="cles-complexes">Clés Complexes</h2>
<p>Les clés ne sont pas limitées à des valeurs simples. Vous pouvez utiliser n'importe quelle valeur JSON pour influencer le tri. Voir AssemblageVue pour le fonctionnement.</p>
<h2 id="les-vues-en-pratique">Les vues en pratique</h2>
<p>Voir ApiVueHttp pour apprendre comment travailler avec les vues.</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>