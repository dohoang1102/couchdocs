<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Troubleshooting</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <h1 id="troubleshooting">Troubleshooting</h1>
<div class="toc">
<ul>
<li><a href="#troubleshooting">Troubleshooting</a><ul>
<li><a href="#upgrade">Upgrade</a></li>
<li><a href="#first-run">First Run</a></li>
<li><a href="#misc-errors">Misc Errors</a></li>
<li><a href="#mapreduce-debugging">Map/Reduce debugging</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="upgrade">Upgrade</h2>
<p>Have you built CouchDB from the Subversion repository?</p>
<p>Did you do a <code>svn up</code> that seemed to break everything?</p>
<p>After every update you must run the following command:</p>
<div class="codehilite"><pre><span class="o">./</span><span class="n">bootstrap</span>
</pre></div>


<p>If you still have problems building try the next troubleshooting tip.</p>
<h2 id="first-run">First Run</h2>
<p>Having problems getting CouchDB to run for the first time?</p>
<p>Follow this simple procedure and report back to mailing list (or IRC) with the
output of each step.</p>
<ol>
<li>
<p>Note down the name of your operating system and your processor architecture.</p>
</li>
<li>
<p>Note down the installed versions of CouchDB's dependancies.</p>
</li>
<li>
<p>Follow the <a href="http://couchdb.apache.org/community/code.html">checkout instructions</a> to get a fresh copy of trunk.</p>
</li>
<li>
<p>Bootstrap from the <code>couchdb</code> directory:</p>
<p>./bootstrap</p>
</li>
</ol>
<p>FreeBSD users: if you get "<code>aclocal: not found</code>" you need to install <code>automake</code>.</p>
<ol>
<li>
<p>Build into a temporary directory:</p>
<p>./configure --prefix=/tmp/couchdb &amp;&amp; make &amp;&amp; make install</p>
</li>
</ol>
<p>FreeBSD users: if you get "<code>Syntax error: end of file unexpected</code>" when you run <code>make</code>, you need to run <code>gmake</code> instead.</p>
<ol>
<li>
<p>Run the couchdb command and log the output:</p>
<p>/tmp/couchdb/bin/couchdb</p>
</li>
<li>
<p>Use your system's kernel trace tool and log the output of the above command.</p>
</li>
<li>
<p>Linux systems should use strace:</p>
<p>strace /tmp/couchdb/bin/couchdb 2&gt; strace.out</p>
</li>
<li>
<p>Please add documentation for your system...</p>
</li>
<li>
<p>Report back to the mailing list (or IRC) with the output from each step.</p>
</li>
</ol>
<h2 id="misc-errors">Misc Errors</h2>
<p>CouchDB using a lot of memory (several hundred MB) on startup?  This one seems to especially affect Dreamhost installs.  It's really an issue with the Erlang VM pre-allocating data structures when ulimit is very large or unlimited.  A detailed dicussion can be found <a href="http://www.erlang.org/cgi-bin/ezmlm-cgi/4/46168">on the erlang-questions list</a>, but the short answer is that you should decrease ulimit -n or define ERL_MAX_PORTS to something reasonable like 1024.</p>
<p>Erlang backtraces are quite "hard" to read for non-Erlangers. The list here tries to give keywords to help you pinpointing your problem and suggests possible solutions</p>
<p>system_limit, erlang, open_port:: Erlang has a default limit of 1024 ports, where each FD, tcp connection, and linked-in driver uses one port. You seem to have exceeded this. You can change it at runtime using the ERL_MAX_PORTS env variable.
 (by Adam Kocoloski, <a href="https">https</a>)</p>
<h2 id="mapreduce-debugging">Map/Reduce debugging</h2>
<p>You can debug your Map and Reduce functions in the js command line. The fact that documents and function definitions are real javascript code makes it trivial to copy and paste both into SpiderMonkey.</p>
<p>First you assign a document to a variable. I like to copy from the Source tab of a doc in Futon:</p>
<div class="codehilite"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="n">doc</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;image-5&quot;</span><span class="p">,</span>
   <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="s">&quot;3-3e1b61291d9102d84e71e27cb46266fc&quot;</span><span class="p">,</span>
   <span class="s">&quot;status&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
   <span class="s">&quot;style&quot;</span><span class="p">:</span> <span class="s">&quot;original&quot;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">object</span> <span class="n">Object</span><span class="p">]</span>
</pre></div>


<p>Next you assign your function to another variable. Again I like to copy from the Source tab of a design doc in Futon:</p>
<div class="codehilite"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="nb">map</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span> <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span> <span class="p">}</span>
<span class="n">function</span> <span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Don't forget to define the emit function as well. I just alias the print function:</p>
<div class="codehilite"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="n">emit</span> <span class="o">=</span> <span class="k">print</span>
<span class="n">function</span> <span class="k">print</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">native</span> <span class="n">code</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p>Now you can manually apply your map function to this document, and see what gets emitted:</p>
<div class="codehilite"><pre><span class="n">js</span><span class="o">&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="n">original</span> <span class="p">[</span><span class="n">object</span> <span class="n">Object</span><span class="p">]</span>
</pre></div>


<p>From here, just keep redefining map and applying it to doc until you are emitting the desired output.</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>