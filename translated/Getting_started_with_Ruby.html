<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Getting_started_with_Ruby</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
        <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul>
        
</div>
      <div id="content">
  <p>Getting started with Ruby and the CouchDB API.</p>
<p>The following shows the basics of working with the raw CouchDB REST api from Ruby. If you want a richer interface that more tightly maps Couch documents into Ruby and also lets you save ruby objects directly to the database, you should check out the RubyLibrary.</p>
<h2>Example Wrapper Class</h2>
<pre><code>require 'net/http'

module Couch

  class Server
    def initialize(host, port, options = nil)
      @host = host
      @port = port
      @options = options
    end

    def delete(uri)
      request(Net::HTTP::Delete.new(uri))
    end

    def get(uri)
      request(Net::HTTP::Get.new(uri))
    end

    def put(uri, json)
      req = Net::HTTP::Put.new(uri)
      req["content-type"] = "application/json"
      req.body = json
      request(req)
    end

    def post(uri, json)
      req = Net::HTTP::Post.new(uri)
      req["content-type"] = "application/json"
      req.body = json
      request(req)
    end

    def request(req)
      res = Net::HTTP.start(@host, @port) { |http|http.request(req) }
      if (not res.kind_of?(Net::HTTPSuccess))
        handle_error(req, res)
      end
      res
    end

    private

    def handle_error(req, res)
      e = RuntimeError.new("#{res.code}:#{res.message}\nMETHOD:#{req.method}\nURI:#{req.path}\n#{res.body}")
      raise e
    end
  end
end
</code></pre>
<h2>Creating a Database</h2>
<p>To create a database called <em>foo</em>:</p>
<pre><code>server = Couch::Server.new("localhost", "5984")
server.put("/foo/", "")
</code></pre>
<h2>Deleting a Database</h2>
<p>To delete a database called <em>foo</em>:</p>
<pre><code>server = Couch::Server.new("localhost", "5984")
server.delete("/foo")
</code></pre>
<h2>Creating a Document</h2>
<p>To create a document in the database <em>foo</em> with the id <em>document_id</em>:</p>
<pre><code>server = Couch::Server.new("localhost", "5984")
doc = &lt;&lt;-JSON
{"type":"comment","body":"First Post!"}
JSON
server.put("/foo/document_id", doc)
</code></pre>
<h2>Reading a Document</h2>
<p>To read a document from database <em>foo</em> with the id <em>document_id</em>:</p>
<pre><code>server = Couch::Server.new("localhost", "5984")
res = server.get("/foo/document_id")
json = res.body
puts json
</code></pre>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>