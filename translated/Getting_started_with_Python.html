<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Getting_started_with_Python</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <p>Getting started with Python and the CouchDB API.</p>
<h2 id="library">Library</h2>
<h3 id="couchdbkit">couchdbkit</h3>
<p>. <a href="http://couchdbkit.org/">http://couchdbkit.org/</a> 
Start using Couchdbkit by reading the <a href="http://couchdbkit.org/docs/gettingstarted.html">Getting Started tutorial</a>.</p>
<p>For django use the <a href="http://www.couchdbkit.org/docs/django-extension.html">django extension</a> of couchdbkit. Other extension exists for <a href="http://docs.formalchemy.org/ext/couchdb.html">formalchemy</a>.</p>
<h3 id="couchdb-python">couchdb-python</h3>
<p>The code for the Python library can be obtained from:</p>
<p>. <a href="http://code.google.com/p/couchdb-python">http://code.google.com/p/couchdb-python</a> 
From a terminal window:</p>
<div class="codehilite"><pre>$ wget <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://peak.telecommunity.com/dist/ez_setup.py&quot;</span><span class="nt">&gt;</span>http://peak.telecommunity.com/dist/ez_setup.py<span class="nt">&lt;/a&gt;</span>     $ sudo python <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;ez_setup.py&quot;</span><span class="nt">&gt;</span>ez_setup.py<span class="nt">&lt;/a&gt;</span>     $ wget <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://pypi.python.org/packages/2.5/C/CouchDB/CouchDB-0.6-py2.5.egg&quot;</span><span class="nt">&gt;</span>http://pypi.python.org/packages/2.5/C/CouchDB/CouchDB-0.6-py2.5.egg<span class="nt">&lt;/a&gt;</span>     $ sudo easy_install CouchDB-0.6-py2.5.egg
</pre></div>


<p>This first downloads and installs the <em>ez_setup.py</em> script which runs python <em>.egg</em> files. The second part downloads the <em>.egg</em> file for CouchDB and installs it along with its dependencies.</p>
<h3 id="couchquery">couchquery</h3>
<p>. <a href="http://mikeal.github.com/couchquery/">http://mikeal.github.com/couchquery/</a> 
An implementation of the python 'shelve' API using couchquery as a backend</p>
<p>. <a href="http://www.randomwalking.com/snippets/couchshelve.text">http://www.randomwalking.com/snippets/couchshelve.text</a> </p>
<h2 id="tutorial-on-using-couchdb-python-with-django">Tutorial on using couchdb-python with Django</h2>
<p>A tutorial on using Django (a Python framework) with CouchDb can be found at</p>
<p>. <a href="http://lethain.com/entry/2008/aug/18/an-introduction-to-using-couchdb-with-django/">http://lethain.com/entry/2008/aug/18/an-introduction-to-using-couchdb-with-django/</a> http://www.eflorenzano.com/blog/post/using-couchdb-django/</p>
<p>Alternatively you can view just the source for that example at</p>
<p>. <a href="http://github.com/lethain/comfy-django-example/tree/master">http://github.com/lethain/comfy-django-example/tree/master</a> </p>
<h2 id="example-wrapper-class">Example Wrapper Class</h2>
<p>Demonstration of basic API-interaction using Python. (note: as of python 2.6, one can use "import json" for the same functionality in this script.)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">&lt;!-- #! /usr/bin/python2.4 --&gt;</span>

import httplib, simplejson  # <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://cheeseshop.python.org/pypi/simplejson&quot;</span><span class="nt">&gt;</span>http://cheeseshop.python.org/pypi/simplejson<span class="nt">&lt;/a&gt;</span>                                 # Here only used for prettyprinting

def prettyPrint(s):
    &quot;&quot;&quot;Prettyprints the json response of an HTTPResponse object&quot;&quot;&quot;

    # HTTPResponse instance -&gt; Python object -&gt; str
    print simplejson.dumps(simplejson.loads(s.read()), sort_keys=True, indent=4)

class Couch:
    &quot;&quot;&quot;Basic wrapper class for operations on a couchDB&quot;&quot;&quot;

    def _\_init_\_(self, host, port=5984, options=None):
        self.host = host
        self.port = port

    def connect(self):
        return httplib.HTTPConnection(self.host, self.port) # No close()

    # Database operations

    def createDb(self, dbName):
        &quot;&quot;&quot;Creates a new database on the server&quot;&quot;&quot;

        r = self.put(&#39;&#39;.join([&#39;/&#39;,dbName,&#39;/&#39;]), &quot;&quot;)
        prettyPrint(r)

    def deleteDb(self, dbName):
        &quot;&quot;&quot;Deletes the database on the server&quot;&quot;&quot;

        r = self.delete(&#39;&#39;.join([&#39;/&#39;,dbName,&#39;/&#39;]))
        prettyPrint(r)

    def listDb(self):
        &quot;&quot;&quot;List the databases on the server&quot;&quot;&quot;

        prettyPrint(self.get(&#39;/_all_dbs&#39;))

    def infoDb(self, dbName):
        &quot;&quot;&quot;Returns info about the couchDB&quot;&quot;&quot;
        r = self.get(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;]))
        prettyPrint(r)

    # Document operations

    def listDoc(self, dbName):
        &quot;&quot;&quot;List all documents in a given database&quot;&quot;&quot;

        r = self.get(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;, &#39;_all_docs&#39;]))
        prettyPrint(r)

    def openDoc(self, dbName, docId):
        &quot;&quot;&quot;Open a document in a given database&quot;&quot;&quot;
        r = self.get(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;, docId,]))
        prettyPrint(r)

    def saveDoc(self, dbName, body, docId=None):
        &quot;&quot;&quot;Save/create a document to/in a given database&quot;&quot;&quot;
        if docId:
            r = self.put(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;, docId]), body)
        else:
            r = self.post(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;]), body)
        prettyPrint(r)

    def deleteDoc(self, dbName, docId):
        # XXX Crashed if resource is non-existent; not so for DELETE on db. Bug?
        # XXX Does not work any more, on has to specify an revid
        #     Either do html head to get the recten revid or provide it as parameter
        r = self.delete(&#39;&#39;.join([&#39;/&#39;, dbName, &#39;/&#39;, docId]))
        prettyPrint(r)

    # Basic http methods

    def get(self, uri):
        c = self.connect()
        headers = {&quot;Accept&quot;: &quot;application/json&quot;}
        c.request(&quot;GET&quot;, uri, None, headers)
        return c.getresponse()

    def post(self, uri, body):
        c = self.connect()
        headers = {&quot;Content-type&quot;: &quot;application/json&quot;}
        c.request(&#39;POST&#39;, uri, body, headers)
        return c.getresponse()

    def put(self, uri, body):
        c = self.connect()
        if len(body) &gt; 0:
            headers = {&quot;Content-type&quot;: &quot;application/json&quot;}
            c.request(&quot;PUT&quot;, uri, body, headers)
        else:
            c.request(&quot;PUT&quot;, uri, body)
        return c.getresponse()

    def delete(self, uri):
        c = self.connect()
        c.request(&quot;DELETE&quot;, uri)
        return c.getresponse()
</pre></div>
</td></tr></table>

<h2 id="usage-example">Usage Example</h2>
<div class="codehilite"><pre><span class="n">def</span> <span class="n">test</span><span class="p">():</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">Couch</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="s">&#39;5984&#39;</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;\nCreate database &#39;mydb&#39;:&quot;</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">createDb</span><span class="p">(</span><span class="s">&#39;mydb&#39;</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;\nList databases on server:&quot;</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">listDb</span><span class="p">()</span>

    <span class="k">print</span> <span class="s">&quot;\nCreate a document &#39;mydoc&#39; in database &#39;mydb&#39;:&quot;</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    {</span>
<span class="s">        &quot;</span><span class="n">value</span><span class="s">&quot;:</span>
<span class="s">        {</span>
<span class="s">            &quot;</span><span class="n">Subject</span><span class="s">&quot;:&quot;</span><span class="n">I</span> <span class="n">like</span> <span class="n">Planktion</span><span class="s">&quot;,</span>
<span class="s">            &quot;</span><span class="n">Author</span><span class="s">&quot;:&quot;</span><span class="n">Rusty</span><span class="s">&quot;,</span>
<span class="s">            &quot;</span><span class="n">PostedDate</span><span class="s">&quot;:&quot;</span><span class="mi">2006</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">15</span><span class="n">T17:30:12</span><span class="o">-</span><span class="mo">04</span><span class="p">:</span><span class="mo">00</span><span class="s">&quot;,</span>
<span class="s">            &quot;</span><span class="n">Tags</span><span class="s">&quot;:[&quot;</span><span class="n">plankton</span><span class="s">&quot;, &quot;</span><span class="n">baseball</span><span class="s">&quot;, &quot;</span><span class="n">decisions</span><span class="s">&quot;],</span>
<span class="s">            &quot;</span><span class="n">Body</span><span class="s">&quot;:&quot;</span><span class="n">I</span> <span class="n">decided</span> <span class="n">today</span> <span class="n">that</span> <span class="n">I</span> <span class="n">don</span><span class="s">&#39;t like baseball. I like plankton.&quot;</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
<span class="s">    foo.saveDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;, doc, &#39;</span><span class="n">mydoc</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nCreate a document, using an assigned docId:&quot;</span>
<span class="s">    foo.saveDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;, doc)</span>

<span class="s">    print &quot;\nList all documents in database &#39;</span><span class="n">mydb</span><span class="s">&#39;&quot;</span>
<span class="s">    foo.listDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nRetrieve document &#39;</span><span class="n">mydoc</span><span class="s">&#39; in database &#39;</span><span class="n">mydb</span><span class="s">&#39;:&quot;</span>
<span class="s">    foo.openDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;, &#39;</span><span class="n">mydoc</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nDelete document &#39;</span><span class="n">mydoc</span><span class="s">&#39; in database &#39;</span><span class="n">mydb</span><span class="s">&#39;:&quot;</span>
<span class="s">    foo.deleteDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;, &#39;</span><span class="n">mydoc</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nList all documents in database &#39;</span><span class="n">mydb</span><span class="s">&#39;&quot;</span>
<span class="s">    foo.listDoc(&#39;</span><span class="n">mydb</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nList info about database &#39;</span><span class="n">mydb</span><span class="s">&#39;:&quot;</span>
<span class="s">    foo.infoDb(&#39;</span><span class="n">mydb</span><span class="s">&#39;)</span>

<span class="s">    print &quot;\nDelete database &#39;</span><span class="n">mydb</span><span class="s">&#39;:&quot;</span>
<span class="s">    foo.deleteDb(&#39;</span><span class="n">mydb</span><span class="err">&#39;</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;\nList databases on server:&quot;</span>
    <span class="n">foo</span><span class="o">.</span><span class="n">listDb</span><span class="p">()</span>

<span class="k">if</span> <span class="n">_</span><span class="o">\</span><span class="n">_name__</span> <span class="o">==</span> <span class="s">&quot;_\_main_\_&quot;</span><span class="p">:</span>
    <span class="n">test</span><span class="p">()</span>
</pre></div>


<h2 id="sample-output">Sample Output</h2>
<div class="codehilite"><pre><span class="n">Create</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">List</span> <span class="n">databases</span> <span class="n">on</span> <span class="n">server:</span>
<span class="p">[</span>
    <span class="s">&quot;mydb&quot;</span>
<span class="p">]</span>

<span class="n">Create</span> <span class="n">a</span> <span class="n">document</span> <span class="s">&#39;mydoc&#39;</span> <span class="n">in</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;mydoc&quot;</span><span class="p">,</span>
    <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">362213977</span><span class="p">,</span>
    <span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">Create</span> <span class="n">a</span> <span class="n">document</span><span class="p">,</span> <span class="n">using</span> <span class="n">an</span> <span class="n">assigned</span> <span class="n">docId:</span>
<span class="p">{</span>
    <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;CF29360495B2AAB44C7E43E5752A5123&quot;</span><span class="p">,</span>
    <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">627930386</span><span class="p">,</span>
    <span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">List</span> <span class="n">all</span> <span class="n">documents</span> <span class="n">in</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span>
<span class="p">{</span>
    <span class="s">&quot;rows&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;CF29360495B2AAB44C7E43E5752A5123&quot;</span><span class="p">,</span>
            <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">627930386</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;mydoc&quot;</span><span class="p">,</span>
            <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">362213977</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">&quot;view&quot;</span><span class="p">:</span> <span class="s">&quot;_all_docs&quot;</span>
<span class="p">}</span>

<span class="n">Retrieve</span> <span class="n">document</span> <span class="s">&#39;mydoc&#39;</span> <span class="n">in</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;mydoc&quot;</span><span class="p">,</span>
    <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">362213977</span><span class="p">,</span>
    <span class="s">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&quot;Author&quot;</span><span class="p">:</span> <span class="s">&quot;Rusty&quot;</span><span class="p">,</span>
        <span class="s">&quot;Body&quot;</span><span class="p">:</span> <span class="s">&quot;I decided today that I don&#39;t like baseball. I like plankton.&quot;</span><span class="p">,</span>
        <span class="s">&quot;PostedDate&quot;</span><span class="p">:</span> <span class="s">&quot;2006-08-15T17:30:12-04:00&quot;</span><span class="p">,</span>
        <span class="s">&quot;Subject&quot;</span><span class="p">:</span> <span class="s">&quot;I like Planktion&quot;</span><span class="p">,</span>
        <span class="s">&quot;Tags&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s">&quot;plankton&quot;</span><span class="p">,</span>
            <span class="s">&quot;baseball&quot;</span><span class="p">,</span>
            <span class="s">&quot;decisions&quot;</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Delete</span> <span class="n">document</span> <span class="s">&#39;mydoc&#39;</span> <span class="n">in</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">3811288472</span><span class="p">,</span>
    <span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">List</span> <span class="n">all</span> <span class="n">documents</span> <span class="n">in</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span>
<span class="p">{</span>
    <span class="s">&quot;rows&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">&quot;_id&quot;</span><span class="p">:</span> <span class="s">&quot;CF29360495B2AAB44C7E43E5752A5123&quot;</span><span class="p">,</span>
            <span class="s">&quot;_rev&quot;</span><span class="p">:</span> <span class="mi">627930386</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">&quot;view&quot;</span><span class="p">:</span> <span class="s">&quot;_all_docs&quot;</span>
<span class="p">}</span>

<span class="n">List</span> <span class="n">info</span> <span class="n">about</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;db_name&quot;</span><span class="p">:</span> <span class="s">&quot;mydb&quot;</span><span class="p">,</span>
    <span class="s">&quot;doc_count&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&quot;update_seq&quot;</span><span class="p">:</span> <span class="mi">3</span>
<span class="p">}</span>

<span class="n">Delete</span> <span class="n">database</span> <span class="s">&#39;mydb&#39;</span><span class="p">:</span>
<span class="p">{</span>
    <span class="s">&quot;ok&quot;</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>

<span class="n">List</span> <span class="n">databases</span> <span class="n">on</span> <span class="n">server:</span>
<span class="o">[]</span>
</pre></div>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>