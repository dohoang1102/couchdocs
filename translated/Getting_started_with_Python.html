<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Getting_started_with_Python</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
        <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul>
        
</div>
      <div id="content">
  <p>Getting started with Python and the CouchDB API.</p>
<h2>Library</h2>
<h3>couchdbkit</h3>
<p>. http://couchdbkit.org/</p>
<p>Start using Couchdbkit by reading the <a href="http://couchdbkit.org/docs/gettingstarted.html">Getting Started tutorial</a>.</p>
<p>For django use the <a href="http://www.couchdbkit.org/docs/django-extension.html">django extension</a> of couchdbkit. Other extension exists for <a href="http://docs.formalchemy.org/ext/couchdb.html">formalchemy</a>.</p>
<h3>couchdb-python</h3>
<p>The code for the Python library can be obtained from:</p>
<p>. http://code.google.com/p/couchdb-python</p>
<p>From a terminal window:</p>
<pre><code>$ wget http://peak.telecommunity.com/dist/ez_setup.py
$ sudo python ez_setup.py
$ wget http://pypi.python.org/packages/2.5/C/CouchDB/CouchDB-0.6-py2.5.egg
$ sudo easy_install CouchDB-0.6-py2.5.egg
</code></pre>
<p>This first downloads and installs the <em>ez_setup.py</em> script which runs python <em>.egg</em> files. The second part downloads the <em>.egg</em> file for CouchDB and installs it along with its dependencies.</p>
<h3>couchquery</h3>
<p>. http://mikeal.github.com/couchquery/</p>
<h2>Tutorial on using couchdb-python with Django</h2>
<p>A tutorial on using Django (a Python framework) with CouchDb can be found at</p>
<p>. http://lethain.com/entry/2008/aug/18/an-introduction-to-using-couchdb-with-django/ http://www.eflorenzano.com/blog/post/using-couchdb-django/</p>
<p>Alternatively you can view just the source for that example at</p>
<p>. http://github.com/lethain/comfy-django-example/tree/master</p>
<h2>Example Wrapper Class</h2>
<p>Demonstration of basic API-interaction using Python. (note: as of python 2.6, one can use "import json" for the same functionality in this script.)</p>
<pre><code>&lt;!-- #! /usr/bin/python2.4 --&gt;

import httplib, simplejson  # http://cheeseshop.python.org/pypi/simplejson
                            # Here only used for prettyprinting

def prettyPrint(s):
    """Prettyprints the json response of an HTTPResponse object"""

    # HTTPResponse instance -&gt; Python object -&gt; str
    print simplejson.dumps(simplejson.loads(s.read()), sort_keys=True, indent=4)

class Couch:
    """Basic wrapper class for operations on a couchDB"""

    def _\_init_\_(self, host, port=5984, options=None):
        self.host = host
        self.port = port

    def connect(self):
        return httplib.HTTPConnection(self.host, self.port) # No close()

    # Database operations

    def createDb(self, dbName):
        """Creates a new database on the server"""

        r = self.put(''.join(['/',dbName,'/']), "")
        prettyPrint(r)

    def deleteDb(self, dbName):
        """Deletes the database on the server"""

        r = self.delete(''.join(['/',dbName,'/']))
        prettyPrint(r)

    def listDb(self):
        """List the databases on the server"""

        prettyPrint(self.get('/_all_dbs'))

    def infoDb(self, dbName):
        """Returns info about the couchDB"""
        r = self.get(''.join(['/', dbName, '/']))
        prettyPrint(r)

    # Document operations

    def listDoc(self, dbName):
        """List all documents in a given database"""

        r = self.get(''.join(['/', dbName, '/', '_all_docs']))
        prettyPrint(r)

    def openDoc(self, dbName, docId):
        """Open a document in a given database"""
        r = self.get(''.join(['/', dbName, '/', docId,]))
        prettyPrint(r)

    def saveDoc(self, dbName, body, docId=None):
        """Save/create a document to/in a given database"""
        if docId:
            r = self.put(''.join(['/', dbName, '/', docId]), body)
        else:
            r = self.post(''.join(['/', dbName, '/']), body)
        prettyPrint(r)

    def deleteDoc(self, dbName, docId):
        # XXX Crashed if resource is non-existent; not so for DELETE on db. Bug?
        # XXX Does not work any more, on has to specify an revid
        #     Either do html head to get the recten revid or provide it as parameter
        r = self.delete(''.join(['/', dbName, '/', docId]))
        prettyPrint(r)

    # Basic http methods

    def get(self, uri):
        c = self.connect()
        headers = {"Accept": "application/json"}
        c.request("GET", uri, None, headers)
        return c.getresponse()

    def post(self, uri, body):
        c = self.connect()
        headers = {"Content-type": "application/json"}
        c.request('POST', uri, body, headers)
        return c.getresponse()

    def put(self, uri, body):
        c = self.connect()
        if len(body) &gt; 0:
            headers = {"Content-type": "application/json"}
            c.request("PUT", uri, body, headers)
        else:
            c.request("PUT", uri, body)
        return c.getresponse()

    def delete(self, uri):
        c = self.connect()
        c.request("DELETE", uri)
        return c.getresponse()
</code></pre>
<h2>Usage Example</h2>
<pre><code>def test():
    foo = Couch('localhost', '5984')

    print "\nCreate database 'mydb':"
    foo.createDb('mydb')

    print "\nList databases on server:"
    foo.listDb()

    print "\nCreate a document 'mydoc' in database 'mydb':"
    doc = """
    {
        "value":
        {
            "Subject":"I like Planktion",
            "Author":"Rusty",
            "PostedDate":"2006-08-15T17:30:12-04:00",
            "Tags":["plankton", "baseball", "decisions"],
            "Body":"I decided today that I don't like baseball. I like plankton."
        }
    }
    """
    foo.saveDoc('mydb', doc, 'mydoc')

    print "\nCreate a document, using an assigned docId:"
    foo.saveDoc('mydb', doc)

    print "\nList all documents in database 'mydb'"
    foo.listDoc('mydb')

    print "\nRetrieve document 'mydoc' in database 'mydb':"
    foo.openDoc('mydb', 'mydoc')

    print "\nDelete document 'mydoc' in database 'mydb':"
    foo.deleteDoc('mydb', 'mydoc')

    print "\nList all documents in database 'mydb'"
    foo.listDoc('mydb')

    print "\nList info about database 'mydb':"
    foo.infoDb('mydb')

    print "\nDelete database 'mydb':"
    foo.deleteDb('mydb')

    print "\nList databases on server:"
    foo.listDb()

if _\_name__ == "_\_main_\_":
    test()
</code></pre>
<h2>Sample Output</h2>
<pre><code>Create database 'mydb':
{
    "ok": true
}

List databases on server:
[
    "mydb"
]

Create a document 'mydoc' in database 'mydb':
{
    "_id": "mydoc",
    "_rev": 362213977,
    "ok": true
}

Create a document, using an assigned docId:
{
    "_id": "CF29360495B2AAB44C7E43E5752A5123",
    "_rev": 627930386,
    "ok": true
}

List all documents in database 'mydb'
{
    "rows": [
        {
            "_id": "CF29360495B2AAB44C7E43E5752A5123",
            "_rev": 627930386
        },
        {
            "_id": "mydoc",
            "_rev": 362213977
        }
    ],
    "view": "_all_docs"
}

Retrieve document 'mydoc' in database 'mydb':
{
    "_id": "mydoc",
    "_rev": 362213977,
    "value": {
        "Author": "Rusty",
        "Body": "I decided today that I don't like baseball. I like plankton.",
        "PostedDate": "2006-08-15T17:30:12-04:00",
        "Subject": "I like Planktion",
        "Tags": [
            "plankton",
            "baseball",
            "decisions"
        ]
    }
}

Delete document 'mydoc' in database 'mydb':
{
    "_rev": 3811288472,
    "ok": true
}

List all documents in database 'mydb'
{
    "rows": [
        {
            "_id": "CF29360495B2AAB44C7E43E5752A5123",
            "_rev": 627930386
        }
    ],
    "view": "_all_docs"
}

List info about database 'mydb':
{
    "db_name": "mydb",
    "doc_count": 1,
    "update_seq": 3
}

Delete database 'mydb':
{
    "ok": true
}

List databases on server:
[]
</code></pre>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>