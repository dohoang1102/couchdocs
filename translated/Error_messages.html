<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - Error_messages</title>
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/code_highlight.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
  <strong>Navigation</strong>
<ul>
  <li><a href="FrontPage.html">Overview</a></li>
  <li><a href="FrontPage.html#using-couchdb">Using CouchDB</a></li>
  <li><a href="FrontPage.html#when-things-go-wrong">When Things Go Wrong</a></li>
  <li><a href="FrontPage.html#community">Community</a></li>
  <li><a href="FrontPage.html#getting-involved">Get Involved</a></li>
  <li><a href="FrontPage.html#books">Books</a></li>
</ul>

<strong>Short Cuts</strong>
<ul>
  <li><a href="Reference.html">Reference</a></li>
  <li><a href="Frequently_asked_questions.html">FAQ</a></li>
</ul>


      <!-- <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul> -->
        
</div>
      <div id="content">
  <h1 id="error-messages">Error Messages</h1>
<div class="toc">
<ul>
<li><a href="#error-messages">Error Messages</a><ul>
<li><a href="#installation-errors">Installation errors</a><ul>
<li><a href="#missing-icu-config">Missing icu-config</a></li>
<li><a href="#erlang-version-is-less-than-565-r12b">Erlang version is less than 5.6.5 (R12B)</a></li>
<li><a href="#incorrect-ld_library_path">Incorrect LD_LIBRARY_PATH</a></li>
<li><a href="#binary-architecture-mismatch-osx">Binary Architecture Mismatch OSX</a></li>
<li><a href="#binary-architecture-mismatch-solarissparc">Binary Architecture Mismatch Solaris/SPARC</a></li>
<li><a href="#unavailable-port">Unavailable Port</a></li>
<li><a href="#missing-openssl">Missing OpenSSL</a></li>
<li><a href="#incorrect-permissions-or-missing-directories">Incorrect Permissions or Missing Directories</a></li>
<li><a href="#crash-on-startup">Crash On Startup</a></li>
</ul>
</li>
<li><a href="#runtime-errors">Runtime Errors</a><ul>
<li><a href="#function-raised-exception-cannot-encode-undefined-value-as-json">function raised exception (Cannot encode 'undefined' value as JSON)</a></li>
<li><a href="#replication-received-exception-errorbadmatchreasonerroralready_present">replication received exception ({"error":"badmatch","reason":"{error,already_present}"})</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>Explanation and solution of error messages you may experience while building or running CouchDB.</p>
<h2 id="installation-errors">Installation errors</h2>
<h3 id="missing-icu-config">Missing icu-config</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre>*** The icu-config script could not be found. Make sure it is
*** in your path, and that taglib is properly installed.
*** Or see <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://ibm.com/software/globalization/icu/&quot;</span><span class="nt">&gt;</span>http://ibm.com/software/globalization/icu/<span class="nt">&lt;/a&gt;</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>Install ICU and use <code>locate</code> to find the <code>icu-config</code> command:</p>
<div class="codehilite"><pre><span class="n">locate</span> <span class="n">icu</span><span class="o">-</span><span class="n">config</span>
</pre></div>


<p>For me on Ubuntu 8.04 server I just did:</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libicu</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>Take the directory from the output of this command and add it to your <code>PATH</code>:</p>
<div class="codehilite"><pre><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="s">&quot;$PATH:/usr/local/bin&quot;</span>
</pre></div>


<h3 id="erlang-version-is-less-than-565-r12b">Erlang version is less than 5.6.5 (R12B)</h3>
<p><strong>Problem</strong></p>
<p>Even after doing sudo apt-get install erlang you are getting the following error on ubuntu 8.04:</p>
<div class="codehilite"><pre><span class="err">configure:</span> <span class="err">error:</span> <span class="err">The</span> <span class="err">installed</span> <span class="err">Erlang</span> <span class="err">version</span> <span class="err">is</span> <span class="err">less</span> <span class="err">than</span> <span class="err">5.6.5</span> <span class="err">(R12B).</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>To get a later version without bothering with installing from source edit /etc/apt/sources.list and locate the following line:</p>
<div class="codehilite"><pre><span class="k">deb</span> <span class="s">&lt;a</span> <span class="kp">href=&quot;http://us.archive.ubuntu.com/ubuntu/&quot;&gt;http://us.archive.ubuntu.com/ubuntu/&lt;/a&gt;</span> <span class="kp">hardy</span> <span class="kp">universe</span>
</pre></div>


<p>Change it to the following</p>
<div class="codehilite"><pre><span class="k">deb</span> <span class="s">&lt;a</span> <span class="kp">href=&quot;http://us.archive.ubuntu.com/ubuntu/&quot;&gt;http://us.archive.ubuntu.com/ubuntu/&lt;/a&gt;</span> <span class="kp">intrepid</span> <span class="kp">universe</span>
</pre></div>


<p>Save and then run:</p>
<div class="codehilite"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
</pre></div>


<p>You should now be able to install it by doing:</p>
<div class="codehilite"><pre><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">erlang</span><span class="o">-</span><span class="n">nox</span> <span class="n">erlang</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>Test you version and confirm you see something greater than 5.6.0 </p>
<div class="codehilite"><pre><span class="n">erl</span>
</pre></div>


<h3 id="incorrect-ld_library_path">Incorrect LD_LIBRARY_PATH</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">couchdb</span>      
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>

<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,{</span><span class="n">error</span><span class="p">,{</span><span class="n">open_error</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">}}</span><span class="err">​</span><span class="p">}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">()</span>
</pre></div>


<p>or</p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">couchdb</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>

<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,</span><span class="s">&quot;libjs.so: cannot open shared object file: No such file or directory&quot;</span><span class="p">}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">(</span><span class="n">libjs</span><span class="o">.</span><span class="n">so:</span> <span class="n">cannot</span> <span class="nb">open</span> <span class="n">shared</span> <span class="n">object</span> <span class="n">file:</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">)</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>You must correctly set your <code>LD_LIBRARY_PATH</code> environment variable so that it picks up your installed libraries. On Mac OS X, the equivalent variable is <code>DYLD_LIBRARY_PATH</code>.</p>
<p>Example running as normal user:</p>
<div class="codehilite"><pre><span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/lib:/</span><span class="n">usr</span><span class="sr">/local/s</span><span class="n">pidermonkey</span><span class="o">/</span><span class="n">lib</span> <span class="n">couchdb</span>
</pre></div>


<p>Example running as <code>couchdb</code> user:</p>
<div class="codehilite"><pre><span class="n">echo</span> <span class="n">LD_LIBRARY_PATH</span><span class="o">=</span><span class="sr">/usr/</span><span class="nb">local</span><span class="sr">/lib:/</span><span class="n">usr</span><span class="sr">/local/s</span><span class="n">pidermonkey</span><span class="o">/</span><span class="n">lib</span> <span class="n">couchdb</span> <span class="o">|</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">couchdb</span> <span class="n">sh</span>
</pre></div>


<p>Similar instructions are on the InstallingSpiderMonkey page.</p>
<h3 id="binary-architecture-mismatch-osx">Binary Architecture Mismatch OSX</h3>
<p>On Mac OS X, libraries and executables can be <em>fat binaries</em> that support multiple processor architectures (PPC and x86, 32 and 64 bit). But that also means you will run into problems when trying to load a library into an application if that library doesn't support the architecture used by the application process.</p>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">couchdb</span>      
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>

<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,{</span><span class="n">error</span><span class="p">,{</span><span class="n">open_error</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">}}</span><span class="err">​</span><span class="p">}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">()</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>You've probably built Erlang with the 64 bit option enabled. The problem is that ICU, which CouchDB attempts to load at startup time, has not been compiled with 64 bit support, so it can't be loaded into the 64bit Erlang process.</p>
<p>For now you'll have to recompile Erlang, and resist the temptation to build a 64 bit binary (just omit the <code>--enable-darwin-64bit</code> option). The <code>--enable-darwin-universal</code> option works okay, but note that currently there's no universal build of ICU available.</p>
<h3 id="binary-architecture-mismatch-solarissparc">Binary Architecture Mismatch Solaris/SPARC</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>

<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,</span><span class="s">&quot;ld.so.1: beam.smp: fatal: relocation</span>
<span class="s">error: file</span>
<span class="s">/opt/couchdb-0.8.1//lib/couchdb/erlang/lib/couch-0.8.1-incubating/priv/lib/couch_erl_driver.so:</span>
<span class="s">symbol ucol_close_4_0: referenced symbol not found&quot;</span><span class="p">}</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">(</span><span class="n">ld</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="mi">1</span><span class="p">:</span> <span class="n">beam</span><span class="o">.</span><span class="n">smp:</span> <span class="n">fatal:</span> <span class="n">relocation</span> <span class="n">error:</span>
<span class="n">file</span>
<span class="sr">/opt/co</span><span class="n">uchdb</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">1</span><span class="sr">//</span><span class="n">lib</span><span class="sr">/couchdb/</span><span class="n">erlang</span><span class="sr">/lib/co</span><span class="n">uch</span><span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="n">incubating</span><span class="sr">/priv/</span><span class="n">lib</span><span class="o">/</span><span class="n">couch_erl_driver</span><span class="o">.</span><span class="n">so:</span>
<span class="n">symbol</span> <span class="n">ucol_close_4_0:</span> <span class="n">r</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>Solaris provides an old version of the ICU library.  On SPARC hardware, when building the current version of ICU, it defaults to 64bits, while erlang and spidermonkey defaulted to 32bit, so when linking, the linker picks the outdated version.</p>
<p>The solution is to rebuild ICU for 32bits.  At the ./configure step, add this flag, "--enable-64bit-libs=no".</p>
<p>Also, use LD_LIBRARY_PATH or crle to make /usr/local/lib earlier in the search path than /usr/lib.</p>
<h3 id="unavailable-port">Unavailable Port</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">couchdb</span>      
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="n">a747640</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>
<span class="n">Failure</span> <span class="n">to</span> <span class="n">start</span> <span class="n">Mochiweb:</span> <span class="n">eaddrinuse</span>
<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,{{</span><span class="n">badmatch</span><span class="p">,{</span><span class="n">error</span><span class="p">,</span><span class="nb">shutdown</span><span class="p">}},[{</span><span class="n">couch_server_sup</span><span class="p">,</span><span class="n">start_server</span><span class="p">,</span><span class="mi">1</span><span class="p">},{</span><span class="n">erl_eval</span><span class="p">,</span><span class="n">do_apply</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="n">erl_eval</span><span class="p">,</span><span class="n">exprs</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_it</span><span class="p">,</span><span class="mi">1</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_em</span><span class="p">,</span><span class="mi">1</span><span class="p">}]}}</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>Edit your <code>/etc/couchdb/couch.ini</code> file and change the <code>Port</code> setting to an available port.</p>
<h3 id="missing-openssl">Missing OpenSSL</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">bin</span><span class="o">/</span><span class="n">couchdb</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">8</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>

<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,{</span><span class="nb">undef</span><span class="p">,[{</span><span class="n">crypto</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="o">[]</span><span class="p">},{</span><span class="n">erl_eval</span><span class="p">,</span><span class="n">do_apply</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_it</span><span class="p">,</span><span class="mi">1</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_em</span><span class="p">,</span><span class="mi">1</span><span class="p">}]}}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">()</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>You are missing erlang SSL support.</p>
<p>You may not have installed the package that provides it (for example, erlang-ssl).  Check $(libdir)/erlang/lib/ssl-*/ and make sure it contains more than just an include/ subdirectory.</p>
<p>If you compiled by hand, you need to install the OpenSSL libraries and recompile Erlang with SSL enabled.</p>
<h3 id="incorrect-permissions-or-missing-directories">Incorrect Permissions or Missing Directories</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">bin</span><span class="o">/</span><span class="n">couchdb</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="n">a691361</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>
<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,{{</span><span class="n">badmatch</span><span class="p">,{</span><span class="n">error</span><span class="p">,</span><span class="nb">shutdown</span><span class="p">}},[{</span><span class="n">couch_server_sup</span><span class="p">,</span><span class="n">start_server</span><span class="p">,</span><span class="mi">1</span><span class="p">},{</span><span class="n">erl_eval</span><span class="p">,</span><span class="n">do_apply</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="n">erl_eval</span><span class="p">,</span><span class="n">exprs</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_it</span><span class="p">,</span><span class="mi">1</span><span class="p">},{</span><span class="n">init</span><span class="p">,</span><span class="n">start_em</span><span class="p">,</span><span class="mi">1</span><span class="p">}]}}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">()</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>You need to make sure that the user running couchdb has permissions to write to /usr/local/var/lib/couchdb and /usr/local/var/log/couchdb. This error message may also appear if CouchDB is trying to bind to a port that is already in use.</p>
<p>Also check that the directories specified in your local.ini are there, like the database_dir and the directory where the log file is created. If they are not there, create them.</p>
<h3 id="crash-on-startup">Crash On Startup</h3>
<p><strong>Problem</strong></p>
<div class="codehilite"><pre><span class="nv">$</span> <span class="nv">sudo</span> <span class="n">couchdb</span>
<span class="n">Apache</span> <span class="n">CouchDB</span> <span class="mi">0</span><span class="o">.</span><span class="mi">9</span><span class="o">.</span><span class="mi">0</span><span class="n">a720049</span><span class="o">-</span><span class="n">incubating</span> <span class="p">(</span><span class="n">LogLevel</span><span class="o">=</span><span class="n">info</span><span class="p">)</span> <span class="n">is</span> <span class="n">starting</span><span class="o">.</span>
<span class="p">{</span><span class="s">&quot;init terminating in do_boot&quot;</span><span class="p">,</span><span class="s">&quot;Driver is an inappropriate Mach-O file&quot;</span><span class="p">}</span>

<span class="n">Crash</span> <span class="nb">dump</span> <span class="n">was</span> <span class="n">written</span> <span class="n">to:</span> <span class="n">erl_crash</span><span class="o">.</span><span class="nb">dump</span>
<span class="n">init</span> <span class="n">terminating</span> <span class="n">in</span> <span class="n">do_boot</span> <span class="p">(</span><span class="n">Driver</span> <span class="n">is</span> <span class="n">an</span> <span class="n">inappropriate</span> <span class="n">Mach</span><span class="o">-</span><span class="n">O</span> <span class="n">file</span><span class="p">)</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>This is related to an update made in erlang (http://www.nabble.com/OS-X-fixes-(HiPE,-ddll-unload)-td19411880.html) Upgrading to version R12B-5 or higher should fix things.</p>
<h2 id="runtime-errors">Runtime Errors</h2>
<h3 id="function-raised-exception-cannot-encode-undefined-value-as-json">function raised exception (Cannot encode 'undefined' value as JSON)</h3>
<p><strong>Problem</strong></p>
<p>A view index fails to build, CouchDB Logs this error message:</p>
<div class="codehilite"><pre><span class="n">function</span> <span class="n">raised</span> <span class="n">exception</span> <span class="p">(</span><span class="n">Cannot</span> <span class="n">encode</span> <span class="s">&#39;undefined&#39;</span> <span class="n">value</span> <span class="n">as</span> <span class="n">JSON</span><span class="p">)</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>The JavaScript code you are using for the map or reduce function is using an object member that is not defined. Consider this document</p>
<div class="codehilite"><pre><span class="p">{</span>
  <span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="s">&quot;XYZ123&quot;</span><span class="p">,</span>
  <span class="s">&quot;_rev&quot;</span><span class="p">:</span><span class="s">&quot;1BB2BB&quot;</span><span class="p">,</span>
  <span class="s">&quot;field&quot;</span><span class="p">:</span><span class="s">&quot;value&quot;</span>
<span class="p">}</span>
</pre></div>


<p>And this map function:</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">address</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>Use guarding to make sure to only access members when they exist in the passed-in document:</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span> <span class="o">&amp;&amp;</span> <span class="n">doc</span><span class="o">.</span><span class="n">address</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">emit</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">address</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>While the above guard will work in most cases, it's worth bearing !JavaScript's falsy set of values in mind. Testing against a property with a value of <code>0</code> (zero), <code>''</code> (empty String), <code>false</code> or <code>null</code> will return false. If this is undesired a guard of the form <code>if (doc.foo !== undefined)</code> should do the trick.</p>
<p>This error can also be caused if a reduce function does not return a value.  For example, this reduce function will cause an error:</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sum</span><span class="p">(</span><span class="nb">values</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>The function needs to return a value:</p>
<div class="codehilite"><pre><span class="n">function</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">values</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">sum</span><span class="p">(</span><span class="nb">values</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h3 id="replication-received-exception-errorbadmatchreasonerroralready_present">replication received exception ({"error":"badmatch","reason":"{error,already_present}"})</h3>
<p><strong>Problem</strong></p>
<p>A replication request receives the following HTTP response</p>
<div class="codehilite"><pre><span class="n">HTTP</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span> <span class="mi">500</span> <span class="n">Internal</span> <span class="n">Server</span> <span class="n">Error</span> <span class="o">-</span> <span class="p">{</span><span class="s">&quot;error&quot;</span><span class="p">:</span><span class="s">&quot;badmatch&quot;</span><span class="p">,</span><span class="s">&quot;reason&quot;</span><span class="p">:</span><span class="s">&quot;{error,already_present}&quot;</span><span class="p">}</span>
</pre></div>


<p><strong>Solution</strong></p>
<p>Alas, there is no information about this at present - it is being looked into. Observed on a 0.9 release running on x86_64 Linux</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>