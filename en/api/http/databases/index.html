<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CouchDocs - HTTP Database API</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen" />
  </head>
  <body>
    <div id="wrapper"> 
      <div id="header">
          <h1><a href="/">CouchDocs</a></h1>
      </div>
      <div id="menu">
        <ul>
        <li>Overview</li>
        <li>Installation</li>
        <li>Introduction</li>
        <li>Conventions</li>
        <li>
          Sections
          <ul>
            <li>Databases</li>
            <li>
              Documents
              <ul>
                <li>Design</li>
                <li>Local</li>
              </ul>
            </li>
            <li>Views</li>
            <li>Rendering</li>
            <li>Configuration</li>
            <li>Statistics</li>
            <li>Security</li>
          </ul>
        </li>
        <li>API Reference</li>
        <li>Client Libraries</li>
        <li>How do I?</li>
        <li>FAQ</li>
      </ul>
        
</div>
      <div id="content">
  <h1>HTTP Database API</h1>
<p>An introduction to the CouchDB HTTP Database API.</p>
<h2>Naming and Addressing</h2>
<p>A database must be named with all lowercase characters (a-z), digits (0-9), or
any of the ''_$()+-/'' characters and must end with a slash in the URL. The
name has to start with characters.</p>
<pre><code>http://couchserver/databasename/
http://couchserver/another/databasename/
http://couchserver/another/database_name(1)/
</code></pre>
<p><strong>Uppercase characters are NOT ALLOWED in database names.</strong></p>
<pre><code>http://couchserver/DBNAME/ (invalid)
http://couchserver/DatabaseName/ (invalid)
http://couchserver/databaseName/ (invalid)
</code></pre>
<p>Note also that a <code>/</code> character in a DB name must be escaped when used in a URL;
if your DB is named <code>his/her</code> then it will be available at
<code>http://localhost:5984/his%2Fher</code>.</p>
<p><strong>Rationale for character restrictions</strong></p>
<p>The limited set of characters for database names is driven by the need to
satisfy the lowest common denominator for file system naming conventions. For
example, disallowing uppercase characters makes compliance with case
insensitive file systems straightforward.</p>
<p>All database files are stored in a single directory on the file system. If your
database includes a ''/'' CouchDB will create a sub-directory structure in the
database directory. That is, a database named ''his/her'', the database file
will be available at ''$dbdir/his/her.couch''. This is useful when you have a
large number of databases and your file system does not like that.</p>
<h2>Working with Databases</h2>
<h3>List Databases</h3>
<p>To get a list of databases on a CouchDB server, use the ''/_all_dbs'' URI:</p>
<pre><code>GET /_all_dbs HTTP/1.1
</code></pre>
<p>And the response:</p>
<pre><code>HTTP/1.1 200 OK
Date: Thu, 17 Aug 2006 05:39:28 +0000GMT
Content-Length: 37
Content-Type: application/json
Connection: close

["somedatabase", "anotherdatabase"]
</code></pre>
<h3>PUT (Create New Database)</h3>
<p>To create a new empty database, perform a PUT operation at the database URL.
Currently the content of the actual PUT is ignored by the webserver.</p>
<p>On success, HTTP status ''201'' is returned. If a database already exists a
''412'' error is returned.</p>
<pre><code>PUT /somedatabase/ HTTP/1.1
Content-Length: 0
</code></pre>
<p>Here is the server's response:</p>
<pre><code>HTTP/1.1 201 Created
Date: Thu, 17 Aug 2006 05:39:28 +0000GMT
Content-Length: 13
Content-Type: application/json
Connection: close

{"ok": true}
</code></pre>
<h3>DELETE</h3>
<p>To delete a database, perform a DELETE operation at the database location.</p>
<p>On success, HTTP status ''200'' is returned. If the database doesn't exist, a
''404'' error is returned.</p>
<pre><code>DELETE /somedatabase/ HTTP/1.1
Content-Length: 0
</code></pre>
<p>Here is the server's response:</p>
<pre><code>HTTP/1.1 200 OK
Date: Thu, 17 Aug 2006 05:39:28 +0000GMT
Content-Length: 67
Content-Type: application/json
Connection: close

{"ok": true}
</code></pre>
<h3>Database Information</h3>
<p>To get information about a particular database, perform a GET operation on the
database, e.g.:</p>
<pre><code>GET /somedatabase/ HTTP/1.1
</code></pre>
<p>The server's response is a JSON object similar to the following:</p>
<pre><code>{
    "compact_running": false, 
    "db_name": "dj", 
    "disk_format_version": 5, 
    "disk_size": 12377, 
    "doc_count": 1, 
    "doc_del_count": 1, 
    "instance_start_time": "1267612389906234", 
    "purge_seq": 0, 
    "update_seq": 4
}
</code></pre>
<h4>Meaning of Result Hash</h4>
<p>||'''Key'''||'''Description'''||'''CouchDB Version'''||
||''db_name''||Name of the database (string)||||
||''doc_count''||Number of documents (including design documents) in the database (int)||||
||''update_seq''||Current number of updates to the database (int)||||
||''purge_seq''||Number of purge operations (int)||||
||''compact_running''||Indicates, if a compaction is running (boolean)||||
||''disk_size''||Current size in Bytes of the database ('''Note''': Size of views indexes on disk are not included)||||
||''instance_start_time''|| Timestamp of CouchDBs start time (int in ms) ||||
||''disk_format_version''|| Current version of the internal database format on disk (int)||||</p>
<h3>Accessing Database-specific options</h3>
<p>Currently there is only one database specific option you can set via a PUT
request. <code>_revs_limit</code> defines a upper bound of document revisions which
CouchDB keeps track of, even after [[Compaction]]. The default is set to 1000
on CouchDB 0.11.</p>
<p>Set <code>_revs_limit</code> of a particular database:</p>
<pre><code>$ curl -X PUT -d "1500" http://localhost:5984/test/_revs_limit
{"ok":true}
</code></pre>
<p>Read <code>_revs_limit</code> of a particular database:</p>
<pre><code>curl -X GET http://localhost:5984/test/_revs_limit
1500
</code></pre>
<h3>Changes</h3>
<p>A list of changes made to documents in the database, in the order they were
made, can be obtained from the database's <code>_changes</code> resource.</p>
<ul>
<li>GET<ul>
<li>since=seqnum (default=0). Start the results from the change immediately
    after the given sequence number.</li>
<li>feed=normal|longpoll|continuous (default=normal). Select the type of feed.</li>
<li>heartbeat=time (milliseconds, default=60000). Period in milliseconds
    after which a empty line is sent in the results. Only applicable for
    ''longpoll'' or ''continuous'' feeds. Overrides any ''timeout''.</li>
<li>timeout=time (milliseconds, default=60000). Maximum period in
    milliseconds to wait for a change before the response is sent, even if
    there are no results. Only applicable for <code>longpoll</code> or <code>continuous</code>
    feeds.</li>
</ul>
</li>
</ul>
<p>By default all changes are immediately returned as a JSON object:</p>
<pre><code>GET /somedatabase/_changes HTTP/1.1

{"results":[
{"seq":1,"id":"fresh","changes":[{"rev":"1-967a00dff5e02add41819138abb3284d"}]},
{"seq":3,"id":"updated","changes":[{"rev":"2-7051cbe5c8faecd085a3fa619e6e6337"}]},
{"seq":5,"id":"deleted","changes":[{"rev":"2-eec205a9d413992850a6e32678485900"}],"deleted":true}
],
"last_seq":5}
</code></pre>
<p>''results'' is the list of changes in sequential order. New and changed
documents only differ in the value of the rev; deleted documents include the
''"deleted": true'' attribute.</p>
<p>''last_seq'' is the sequence number of the last update returned. (Currently it
will always be the same as the ''seq'' of the last item in ''results''.)</p>
<p>Sending a ''since'' param in the query string skips all changes up to and
including the given sequence number:</p>
<pre><code>GET /somedatabase/_changes?since=3 HTTP/1.1

{"results":[
{"seq":5,"id":"deleted","changes":[{"rev":"2-eec205a9d413992850a6e32678485900"}],"deleted":true}
],
"last_seq":5}
</code></pre>
<h4>Long-Polling (Efficient Polling) Feed</h4>
<p>The ''longpoll'' feed (probably most useful used from a browser) is a more
efficient form of polling that waits for a change to occur before the response
is sent. ''longpoll'' avoids the need to frequently poll CouchDB to discover
nothing has changed!</p>
<p>The response is basically the same JSON as is sent for the ''normal'' feed.</p>
<p>A ''timeout'' limits the maximum length of time the connection is open. If
there are no changes before the timeout expires the response's ''results'' will
be an empty list.</p>
<h4>Continuous (Non-Polling) Feed</h4>
<p>Polling the CouchDB server is not a good thing to do. Setting up new HTTP
connections just to tell the client that nothing's happened puts unnecessary
strain on CouchDB.</p>
<p>A ''continuous'' feed stays open and connected to the database until explicitly
closed and changes are sent to the client as they happen, i.e. in near
real-time.</p>
<p>The ''continuous'' feed's response is a little different than the other feed
types to simplify the job of the client - each line of the response is either
empty or a JSON object representing a single change, as found in the normal
feed's ''results''.</p>
<pre><code>GET /somedatabase/_changes?feed=continuous HTTP/1.1

{"seq":1,"id":"fresh","changes":[{"rev":"1-967a00dff5e02add41819138abb3284d"}]}
{"seq":3,"id":"updated","changes":[{"rev":"2-7051cbe5c8faecd085a3fa619e6e6337"}]}
{"seq":5,"id":"deleted","changes":[{"rev":"2-eec205a9d413992850a6e32678485900"}],"deleted":true}
... tum tee tum ...
{"seq":6,"id":"updated","changes":[{"rev":"3-825cb35de44c433bfb2df415563a19de"}]}
</code></pre>
<p>Obviously, "... tum tee tum ..." does not appear in the actual response but
represents a long pause before the change with ''seq'' 6 occurred.</p>
<h2>Compaction</h2>
<p>Databases may be compacted to reduce their disk usage.  For more details,
see [[Compaction]].</p>
</div>
      <div id="footer">
        <p>Hosted on <a href="http://github.com/">Github</a></p>
      </div>
    </div>
  </body>
</html>